<!DOCTYPE html>
<html lang="es" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>Mi Vida Loca - Episodio 2: En la Terraza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        .feedback {
            display: none;
        }
        .draggable {
            cursor: grab;
            transition: all 0.2s ease;
        }
        .draggable:active {
            cursor: grabbing;
            transform: scale(1.05);
        }
        .drop-zone {
            min-height: 50px;
            transition: all 0.3s ease;
        }
        .drop-zone.drag-over {
            background-color: #dbeafe;
            border-color: #3b82f6;
            transform: scale(1.02);
        }
        .instructions {
            font-style: italic;
            color: #6b7280;
        }
        .correct {
            background-color: #dcfce7 !important;
            border-color: #16a34a !important;
        }
        .incorrect {
            background-color: #fef2f2 !important;
            border-color: #dc2626 !important;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .celebration {
            animation: celebrate 0.6s ease-out;
        }
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .character-speech {
            border-left: 4px solid #3b82f6;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .cafe-menu {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        .grammar-box {
            border-left: 4px solid #10b981;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-yellow-100 text-gray-800 p-4 sm:p-6 md:p-8 min-h-screen">

    <!-- Progress Bar -->
    <div class="max-w-4xl mx-auto mb-6">
        <div class="bg-white rounded-full p-1 shadow-sm">
            <div class="bg-gray-200 rounded-full h-3 relative overflow-hidden">
                <div id="progressBar" class="progress-bar bg-gradient-to-r from-orange-400 to-red-500 h-full rounded-full" style="width: 0%"></div>
            </div>
        </div>
        <div class="flex justify-between mt-2 text-sm text-gray-600">
            <span>Progreso del Episodio 2</span>
            <span id="progressText">0% completado</span>
        </div>
    </div>

    <!-- Score Display -->
    <div class="max-w-4xl mx-auto mb-6">
        <div class="bg-white rounded-lg p-4 shadow-sm flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <div class="text-2xl">‚òï</div>
                <div>
                    <div class="font-semibold">Puntuaci√≥n: <span id="totalScore" class="text-orange-600">0</span></div>
                    <div class="text-sm text-gray-600">Racha: <span id="streak">0</span> üî•</div>
                </div>
            </div>
            <div class="text-right">
                <div class="text-sm text-gray-600">Ejercicios completados</div>
                <div class="font-semibold"><span id="completedExercises">0</span>/8</div>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-lg">
        <h1 class="text-3xl sm:text-4xl font-bold text-center bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent mb-8">Mi Vida Loca - Episodio 2: En la Terraza</h1>

        <!-- Contexto del Episodio -->
        <div class="bg-gradient-to-r from-orange-50 to-red-50 p-6 rounded-lg border border-orange-200 mb-8">
            <h2 class="text-xl font-bold text-orange-700 mb-3">‚òï Contexto del Episodio</h2>
            <p class="text-gray-700 mb-3">
                Merche te lleva a la Plaza de Oriente para tomar algo en una terraza. All√≠ ves el Palacio Real 
                y aprendes a pedir en un caf√©. Merche tiene que irse urgentemente y te deja solo/a para pagar la cuenta.
            </p>
            <p class="text-sm text-gray-600 italic">
                Merche takes you to Plaza de Oriente to have something at a terrace caf√©. There you see the Royal Palace 
                and learn how to order at a caf√©. Merche has to leave urgently and leaves you alone to pay the bill.
            </p>
        </div>

        <!-- Video Player -->
        <div class="bg-black rounded-lg overflow-hidden max-w-xl mx-auto shadow-md mb-8">
            <video 
                controls 
                class="w-full aspect-video"
                poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 450'%3E%3Crect width='800' height='450' fill='%23374151'/%3E%3Ctext x='400' y='200' text-anchor='middle' fill='white' font-size='24' font-family='Arial'%3EMi Vida Loca%3C/text%3E%3Ctext x='400' y='230' text-anchor='middle' fill='%23d1d5db' font-size='18' font-family='Arial'%3EEpisodio 2%3C/text%3E%3Cpolygon points='350,270 450,320 350,370' fill='white'/%3E%3C/svg%3E"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
            >
                <source src="mvl02.mp4" type="video/mp4">
                Tu navegador no soporta el elemento de video.
            </video>
            <!-- Fallback if video fails to load -->
            <div class="aspect-video bg-gray-800 flex items-center justify-center text-white" style="display: none;">
                <div class="text-center">
                    <div class="text-4xl mb-2">üé¨</div>
                    <p class="text-lg font-semibold">Mi Vida Loca - Episodio 2</p>
                    <p class="text-sm text-gray-300">Video no disponible</p>
                    <p class="text-xs text-gray-400 mt-2">Aseg√∫rate de que mvl01.mp4 est√© en la misma carpeta</p>
                </div>
            </div>
        </div>

        <!-- Ejercicio 1: Lugares de Madrid -->
        <div class="activity mt-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-orange-500" data-exercise="1">
            <h3 class="text-xl font-semibold mb-3 flex items-center">
                <span class="bg-orange-100 text-orange-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">1</span>
                Lugares de Madrid / <span class="instructions">Places in Madrid</span>
            </h3>
            <p class="text-sm text-gray-600 mb-4">Identifica los lugares que menciona Merche en el episodio.</p>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div class="space-y-3">
                    <div class="bg-gray-50 p-3 rounded-lg hover:bg-orange-50 transition-colors cursor-pointer" onclick="toggleDefinition(this)">
                        <span class="font-bold text-orange-600">Plaza de Oriente</span>
                        <div class="definition hidden mt-2 text-sm text-gray-700 italic">
                            Plaza hist√≥rica frente al Palacio Real - "Es una plaza preciosa"
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg hover:bg-orange-50 transition-colors cursor-pointer" onclick="toggleDefinition(this)">
                        <span class="font-bold text-orange-600">Palacio Real</span>
                        <div class="definition hidden mt-2 text-sm text-gray-700 italic">
                            Residencia oficial de la familia real espa√±ola
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg hover:bg-orange-50 transition-colors cursor-pointer" onclick="toggleDefinition(this)">
                        <span class="font-bold text-orange-600">La terraza</span>
                        <div class="definition hidden mt-2 text-sm text-gray-700 italic">
                            √Årea exterior de un caf√© o restaurante - "Vamos a esta terraza"
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg hover:bg-orange-50 transition-colors cursor-pointer" onclick="toggleDefinition(this)">
                        <span class="font-bold text-orange-600">.......</span>
                        <div class="definition hidden mt-2 text-sm text-gray-700 italic">
                            Estaci√≥n de metro, l√≠nea 5 - donde vive Teresa
                        </div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="bg-gray-50 p-3 rounded-lg hover:bg-orange-50 transition-colors cursor-pointer" onclick="toggleDefinition(this)">
                        <span class="font-bold text-orange-600">Es la hora de la merienda</span>
                        <div class="definition hidden mt-2 text-sm text-gray-700 italic">
                            "It's snack time" - tiempo para tomar algo entre comidas
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg hover:bg-orange-50 transition-colors cursor-pointer" onclick="toggleDefinition(this)">
                        <span class="font-bold text-orange-600">¬øQuieres comer?</span>
                        <div class="definition hidden mt-2 text-sm text-gray-700 italic">
                            "Do you want to eat?" - invitaci√≥n a tomar algo
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg hover:bg-orange-50 transition-colors cursor-pointer" onclick="toggleDefinition(this)">
                        <span class="font-bold text-orange-600">Nos vemos luego</span>
                        <div class="definition hidden mt-2 text-sm text-gray-700 italic">
                            "See you later" - despedida cuando Merche se va
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg hover:bg-orange-50 transition-colors cursor-pointer" onclick="toggleDefinition(this)">
                        <span class="font-bold text-orange-600">La cuenta, por favor</span>
                        <div class="definition hidden mt-2 text-sm text-gray-700 italic">
                            "The bill, please" - para pedir la cuenta en un restaurante
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button onclick="completeExercise(1)" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ‚úì Marcar como completado
                </button>
            </div>
        </div>

        <!-- Ejercicio 2: G√©nero de Sustantivos -->
        <div class="activity mt-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-green-500" data-exercise="2">
            <h3 class="text-xl font-semibold mb-3 flex items-center">
                <span class="bg-green-100 text-green-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">2</span>
                Masculino vs Femenino / <span class="instructions">Masculine vs Feminine</span>
            </h3>
            <p class="text-sm text-gray-600 mb-4">Clasifica las palabras seg√∫n su g√©nero. Recuerda: masculino = UN/EL, femenino = UNA/LA</p>
            
            <div class="grammar-box p-4 rounded-lg mb-4">
                <h4 class="font-semibold mb-2">üìö Regla del episodio:</h4>
                <p class="text-sm mb-2">‚Ä¢ <strong>Masculino:</strong> UN piso, EL caf√© (often end in -o)</p>
                <p class="text-sm">‚Ä¢ <strong>Femenino:</strong> UNA hermana, LA tostada (often end in -a)</p>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6">
                <div>
                    <h4 class="font-semibold mb-3 text-gray-700">Palabras del episodio:</h4>
                    <div class="space-y-2" id="gender-words">
                        <div class="draggable bg-blue-100 border-2 border-blue-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-gender="masculine">
                            piso
                        </div>
                        <div class="draggable bg-blue-100 border-2 border-blue-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-gender="feminine">
                            hermana
                        </div>
                        <div class="draggable bg-blue-100 border-2 border-blue-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-gender="masculine">
                            caf√©
                        </div>
                        <div class="draggable bg-blue-100 border-2 border-blue-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-gender="feminine">
                            tostada
                        </div>
                        <div class="draggable bg-blue-100 border-2 border-blue-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-gender="feminine">
                            cerveza
                        </div>
                        <div class="draggable bg-blue-100 border-2 border-blue-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-gender="masculine">
                            agua
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-3 text-green-700">Masculino (UN/EL):</h4>
                    <div class="space-y-2" id="masculine-zone">
                        <div class="drop-zone border-2 border-dashed border-green-300 p-3 rounded-lg text-center bg-green-50 min-h-[50px] flex items-center justify-center" data-gender="masculine">
                            Arrastra aqu√≠ las palabras masculinas
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-3 text-pink-700">Femenino (UNA/LA):</h4>
                    <div class="space-y-2" id="feminine-zone">
                        <div class="drop-zone border-2 border-dashed border-pink-300 p-3 rounded-lg text-center bg-pink-50 min-h-[50px] flex items-center justify-center" data-gender="feminine">
                            Arrastra aqu√≠ las palabras femeninas
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button onclick="checkGenders()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Verificar G√©neros
                </button>
                <button onclick="resetGenders()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors ml-2">
                    Reiniciar
                </button>
            </div>
            <div id="gender-feedback" class="feedback mt-4 p-3 rounded-lg"></div>
        </div>

        <!-- Ejercicio 3: Men√∫ del Caf√© -->
        <div class="activity mt-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-yellow-500" data-exercise="3">
            <h3 class="text-xl font-semibold mb-3 flex items-center">
                <span class="bg-yellow-100 text-yellow-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">3</span>
                Men√∫ del Caf√© / <span class="instructions">Caf√© Menu</span>
            </h3>
            <p class="text-sm text-gray-600 mb-4">Empareja las bebidas y comidas con sus art√≠culos correctos (un/una).</p>
            
            <div class="cafe-menu p-4 rounded-lg mb-4">
                <h4 class="font-semibold mb-2">‚òï Men√∫ de la Terraza:</h4>
                <p class="text-sm">Completa con UN o UNA seg√∫n corresponda</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div class="space-y-3">
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <select id="cafe-article" class="mr-2 p-1 border rounded">
                            <option value="">...</option>
                            <option value="un">UN</option>
                            <option value="una">UNA</option>
                        </select>
                        <span class="font-medium">caf√© con leche</span>
                    </div>
                    
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <select id="tostada-article" class="mr-2 p-1 border rounded">
                            <option value="">...</option>
                            <option value="un">UN</option>
                            <option value="una">UNA</option>
                        </select>
                        <span class="font-medium">tostada</span>
                    </div>
                    
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <select id="te-article" class="mr-2 p-1 border rounded">
                            <option value="">...</option>
                            <option value="un">UN</option>
                            <option value="una">UNA</option>
                        </select>
                        <span class="font-medium">t√©</span>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <select id="cerveza-article" class="mr-2 p-1 border rounded">
                            <option value="">...</option>
                            <option value="un">UN</option>
                            <option value="una">UNA</option>
                        </select>
                        <span class="font-medium">cerveza</span>
                    </div>
                    
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <select id="agua-article" class="mr-2 p-1 border rounded">
                            <option value="">...</option>
                            <option value="un">UN</option>
                            <option value="una">UNA</option>
                        </select>
                        <span class="font-medium">agua con gas</span>
                    </div>
                    
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <select id="agua-sin-article" class="mr-2 p-1 border rounded">
                            <option value="">...</option>
                            <option value="un">UN</option>
                            <option value="una">UNA</option>
                        </select>
                        <span class="font-medium">agua sin gas</span>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button onclick="checkMenu()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Verificar Men√∫
                </button>
            </div>
            <div id="menu-feedback" class="feedback mt-4 p-3 rounded-lg"></div>
        </div>

        <!-- Ejercicio 4: Di√°logo en el Caf√© -->
        <div class="activity mt-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-purple-500" data-exercise="4">
            <h3 class="text-xl font-semibold mb-3 flex items-center">
                <span class="bg-purple-100 text-purple-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">4</span>
                Conversaci√≥n con el Camarero / <span class="instructions">Conversation with the Waiter</span>
            </h3>
            <p class="text-sm text-gray-600 mb-4">Ordena el di√°logo entre t√∫ y el camarero seg√∫n el episodio.</p>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-semibold mb-3 text-gray-700">Frases desordenadas:</h4>
                    <div class="space-y-2" id="cafe-dialogue-options">
                        <div class="draggable bg-purple-100 border-2 border-purple-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-order="2">
                            "Un caf√© con leche y una tostada"
                        </div>
                        <div class="draggable bg-purple-100 border-2 border-purple-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-order="1">
                            "Hola, buenas tardes. ¬øQu√© quiere tomar?"
                        </div>
                        <div class="draggable bg-purple-100 border-2 border-purple-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-order="4">
                            "Un agua con gas"
                        </div>
                        <div class="draggable bg-purple-100 border-2 border-purple-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-order="3">
                            "¬øAlgo m√°s?"
                        </div>
                        <div class="draggable bg-purple-100 border-2 border-purple-300 p-3 rounded-lg text-center cursor-move" draggable="true" data-order="5">
                            "De acuerdo, gracias"
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-3 text-gray-700">Orden correcto:</h4>
                    <div class="space-y-2" id="cafe-dialogue-order">
                        <div class="drop-zone border-2 border-dashed border-gray-300 p-3 rounded-lg text-center bg-gray-50 min-h-[50px] flex items-center justify-center" data-position="1">
                            1. Camarero saluda...
                        </div>
                        <div class="drop-zone border-2 border-dashed border-gray-300 p-3 rounded-lg text-center bg-gray-50 min-h-[50px] flex items-center justify-center" data-position="2">
                            2. T√∫ pides para Merche...
                        </div>
                        <div class="drop-zone border-2 border-dashed border-gray-300 p-3 rounded-lg text-center bg-gray-50 min-h-[50px] flex items-center justify-center" data-position="3">
                            3. Camarero pregunta...
                        </div>
                        <div class="drop-zone border-2 border-dashed border-gray-300 p-3 rounded-lg text-center bg-gray-50 min-h-[50px] flex items-center justify-center" data-position="4">
                            4. T√∫ pides para ti...
                        </div>
                        <div class="drop-zone border-2 border-dashed border-gray-300 p-3 rounded-lg text-center bg-gray-50 min-h-[50px] flex items-center justify-center" data-position="5">
                            5. Camarero confirma...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button onclick="checkCafeDialogue()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Verificar Di√°logo
                </button>
                <button onclick="resetCafeDialogue()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors ml-2">
                    Reiniciar
                </button>
            </div>
            <div id="cafe-dialogue-feedback" class="feedback mt-4 p-3 rounded-lg"></div>
        </div>

        <!-- Ejercicio 5: Comprensi√≥n Auditiva -->
        <div class="activity mt-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-red-500" data-exercise="5">
            <h3 class="text-xl font-semibold mb-3 flex items-center">
                <span class="bg-red-100 text-red-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">5</span>
                ¬øQu√© Pide Merche? / <span class="instructions">What Does Merche Order?</span>
            </h3>
            <p class="text-sm text-gray-600 mb-4">Responde las preguntas sobre lo que pide Merche en el caf√©.</p>
            
            <div class="space-y-4">
                <div class="character-speech p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">üó£Ô∏è Merche dice:</h4>
                    <p class="italic mb-3">"Yo voy a tomar un caf√© con leche y una tostada"</p>
                    
                    <div class="space-y-3">
                        <div>
                            <p class="font-medium mb-2">1. ¬øQu√© bebida pide Merche? - What drink does Merche order?</p>
                            <div class="space-y-2">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="merche-drink" value="cafe-leche" class="mr-2">
                                    <span>Un caf√© con leche</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="merche-drink" value="te" class="mr-2">
                                    <span>Un t√©</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="merche-drink" value="cerveza" class="mr-2">
                                    <span>Una cerveza</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <p class="font-medium mb-2">2. ¬øQu√© comida pide Merche? - What food does Merche order?</p>
                            <div class="space-y-2">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="merche-food" value="tostada" class="mr-2">
                                    <span>Una tostada</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="merche-food" value="sandwich" class="mr-2">
                                    <span>Un sandwich</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="merche-food" value="nada" class="mr-2">
                                    <span>Nada</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button onclick="checkMercheOrder()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Verificar Respuestas
                </button>
            </div>
            <div id="merche-feedback" class="feedback mt-4 p-3 rounded-lg"></div>
        </div>

        <!-- Ejercicio 6: Frases √ötiles del Caf√© -->
        <div class="activity mt-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-indigo-500" data-exercise="6">
            <h3 class="text-xl font-semibold mb-3 flex items-center">
                <span class="bg-indigo-100 text-indigo-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">6</span>
                Frases del Caf√© / <span class="instructions">Caf√© Phrases</span>
            </h3>
            <p class="text-sm text-gray-600 mb-4">Completa las frases t√≠picas que se usan en un caf√© espa√±ol.</p>
            
            <div class="space-y-4">
                <div class="bg-indigo-50 p-4 rounded-lg">
                    <p class="mb-2"><strong>To greet and ask what the client wants:</strong></p>
                    <p>"Hola, buenas tardes. ¬øQu√© 
                        <select id="phrase1" class="mx-1 p-1 border rounded">
                            <option value="">...</option>
                            <option value="quiere">quiere</option>
                            <option value="necesita">necesita</option>
                            <option value="busca">busca</option>
                        </select>
                        tomar?"
                    </p>
                </div>
                
                <div class="bg-indigo-50 p-4 rounded-lg">
                    <p class="mb-2"><strong>To ask if they want something else:</strong></p>
                    <p>"¬øAlgo 
                        <select id="phrase2" class="mx-1 p-1 border rounded">
                            <option value="">...</option>
                            <option value="m√°s">m√°s</option>
                            <option value="diferente">diferente</option>
                            <option value="especial">especial</option>
                        </select>
                        ?"
                    </p>
                </div>
                
                <div class="bg-indigo-50 p-4 rounded-lg">
                    <p class="mb-2"><strong>To ask for the bill:</strong></p>
                    <p>"La 
                        <select id="phrase3" class="mx-1 p-1 border rounded">
                            <option value="">...</option>
                            <option value="cuenta">cuenta</option>
                            <option value="factura">factura</option>
                            <option value="nota">nota</option>
                        </select>
                        , por favor."
                    </p>
                </div>
                
                <div class="bg-indigo-50 p-4 rounded-lg">
                    <p class="mb-2"><strong>To say you have to do something urgent:</strong></p>
                    <p>"Necesito hacer algo muy 
                        <select id="phrase4" class="mx-1 p-1 border rounded">
                            <option value="">...</option>
                            <option value="urgente">urgente</option>
                            <option value="importante">importante</option>
                            <option value="r√°pido">r√°pido</option>
                        </select>
                        ."
                    </p>
                </div>
            </div>
            
            <div class="mt-4">
                <button onclick="checkPhrases()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Verificar Frases
                </button>
            </div>
            <div id="phrases-feedback" class="feedback mt-4 p-3 rounded-lg"></div>
        </div>

        <!-- Ejercicio 7: Metro de Madrid -->
        <div class="activity mt-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-pink-500" data-exercise="7">
            <h3 class="text-xl font-semibold mb-3 flex items-center">
                <span class="bg-pink-100 text-pink-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">7</span>
                El Metro / <span class="instructions">The Subway</span>
            </h3>
            <p class="text-sm text-gray-600 mb-4">Completa la informaci√≥n sobre el metro que menciona Merche.</p>
            
            <div class="character-speech p-4 rounded-lg mb-4">
                <h4 class="font-semibold mb-2">üöá Merche dice:</h4>
                <p class="italic">"La estaci√≥n de metro es La Latina, en la l√≠nea 5"</p>
            </div>
            
            <div class="space-y-4">
                <div class="bg-pink-50 p-4 rounded-lg">
                    <label class="block font-medium mb-2">¬øCu√°l es el nombre de la estaci√≥n de metro?</label>
                    <input type="text" id="metro-station" class="w-full p-2 border rounded-lg" placeholder="Escribe el nombre de la estaci√≥n...">
                </div>
                
                <div class="bg-pink-50 p-4 rounded-lg">
                    <label class="block font-medium mb-2">¬øEn qu√© l√≠nea est√°?</label>
                    <select id="metro-line" class="w-full p-2 border rounded-lg">
                        <option value="">Selecciona la l√≠nea...</option>
                        <option value="1">L√≠nea 1</option>
                        <option value="2">L√≠nea 2</option>
                        <option value="3">L√≠nea 3</option>
                        <option value="4">L√≠nea 4</option>
                        <option value="5">L√≠nea 5</option>
                        <option value="6">L√≠nea 6</option>
                    </select>
                </div>
                
                <div class="bg-pink-50 p-4 rounded-lg">
                    <p class="font-medium mb-2">¬øPara qu√© le da esta informaci√≥n Merche?</p>
                    <div class="space-y-2">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="metro-reason" value="volver-casa" class="mr-2">
                            <span>Para que puedas volver a casa</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="metro-reason" value="ir-centro" class="mr-2">
                            <span>Para ir al centro de Madrid</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="metro-reason" value="encontrar-teresa" class="mr-2">
                            <span>Para encontrar a Teresa</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button onclick="checkMetro()" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Verificar Metro
                </button>
            </div>
            <div id="metro-feedback" class="feedback mt-4 p-3 rounded-lg"></div>
        </div>

        <!-- Ejercicio 8: Reflexi√≥n Cultural -->
        <div class="activity mt-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-teal-500" data-exercise="8">
            <h3 class="text-xl font-semibold mb-3 flex items-center">
                <span class="bg-teal-100 text-teal-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">8</span>
                Cultura del Caf√© / <span class="instructions">Caf√© Culture</span>
            </h3>
            <p class="text-sm text-gray-600 mb-4">Reflexiona sobre la cultura del caf√© en Espa√±a y comp√°rala con tu pa√≠s.</p>
            
            <div class="bg-teal-50 p-4 rounded-lg mb-4">
                <h4 class="font-semibold mb-2">‚òï La Merienda Espa√±ola</h4>
                <p class="text-sm mb-2">En Espa√±a, "la merienda" es una comida ligera entre el almuerzo y la cena. Es com√∫n ir a una terraza para tomar caf√© y socializar.</p>
                <p class="text-sm text-gray-600 italic">In Spain, "la merienda" is a light meal between lunch and dinner. It's common to go to a terrace to have coffee and socialize.</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block font-medium mb-2">1. ¬øC√≥mo es la cultura del caf√© en tu pa√≠s?</label>
                    <textarea id="coffee-culture" class="w-full p-3 border border-gray-300 rounded-lg h-20 resize-none" placeholder="Describe c√≥mo y cu√°ndo toma caf√© la gente en tu pa√≠s..."></textarea>
                </div>
                
                <div>
                    <label class="block font-medium mb-2">2. ¬øQu√© diferencias notas entre las terrazas espa√±olas y los caf√©s de tu pa√≠s?</label>
                    <textarea id="terrace-differences" class="w-full p-3 border border-gray-300 rounded-lg h-20 resize-none" placeholder="Compara las diferencias que observas..."></textarea>
                </div>
                
                <div>
                    <label class="block font-medium mb-2">3. ¬øTe gusta la idea de "la merienda"? ¬øPor qu√©?</label>
                    <textarea id="merienda-opinion" class="w-full p-3 border border-gray-300 rounded-lg h-20 resize-none" placeholder="Comparte tu opini√≥n sobre esta costumbre espa√±ola..."></textarea>
                </div>
            </div>
            
            <div class="mt-4">
                <button onclick="completeExercise(8)" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ‚úì Marcar como completado
                </button>
            </div>
        </div>

        <!-- Enviar al Profesor -->
        <div class="mt-8 bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-lg border border-purple-200">
            <h3 class="text-xl font-bold text-purple-700 mb-4 flex items-center">
                üìß Enviar Resultados al Profesor
            </h3>
            <p class="text-gray-600 mb-4">Completa tus datos para enviar tu progreso y puntuaci√≥n al profesor.</p>
            
            <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Nombre completo:</label>
                    <input type="text" id="student-name" class="w-full p-2 border rounded-lg" placeholder="Tu nombre completo">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Clase/Grupo:</label>
                    <input type="text" id="student-class" class="w-full p-2 border rounded-lg" placeholder="Ej: Espa√±ol 101, Grupo A">
                </div>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Comentarios adicionales (opcional):</label>
                <textarea id="student-comments" class="w-full p-2 border rounded-lg h-20 resize-none" placeholder="Comparte tus reflexiones sobre el episodio..."></textarea>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-3">
                <button onclick="sendToTeacher()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors flex items-center justify-center">
                    <span class="mr-2">üì§</span> Enviar al Profesor
                </button>
                <button onclick="downloadResults()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors flex items-center justify-center">
                    <span class="mr-2">üíæ</span> Descargar Resultados
                </button>
            </div>
            
            <div id="submission-feedback" class="feedback mt-4 p-3 rounded-lg"></div>
        </div>

        <!-- Resumen Final -->
        <div id="final-summary" class="hidden mt-8 bg-gradient-to-r from-green-100 to-blue-100 p-6 rounded-lg border-2 border-green-300">
            <h3 class="text-2xl font-bold text-center text-green-700 mb-4">¬°Felicidades! üéâ</h3>
            <p class="text-center text-gray-700 mb-4">Has completado todos los ejercicios del Episodio 2: En la Terraza</p>
            <div class="text-center">
                <div class="text-3xl font-bold text-orange-600 mb-2">Puntuaci√≥n Final: <span id="finalScore">0</span></div>
                <div class="text-lg text-gray-600 mb-4">¬°Excelente trabajo aprendiendo espa√±ol!</div>
                <div class="bg-white p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">üéØ Lo que has aprendido:</h4>
                    <ul class="text-left text-sm space-y-1">
                        <li>‚Ä¢ G√©nero de sustantivos (masculino/femenino)</li>
                        <li>‚Ä¢ Vocabulario del caf√© y restaurante</li>
                        <li>‚Ä¢ C√≥mo pedir comida y bebida</li>
                        <li>‚Ä¢ Frases √∫tiles para el caf√©</li>
                        <li>‚Ä¢ Informaci√≥n sobre el metro de Madrid</li>
                        <li>‚Ä¢ Cultura de "la merienda" espa√±ola</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let totalScore = 0;
        let streak = 0;
        let completedExercises = 0;
        const totalExercisesCount = 8;
        let exerciseStates = {};

        // Toggle definition visibility
        function toggleDefinition(element) {
            const definition = element.querySelector('.definition');
            definition.classList.toggle('hidden');
            
            if (!definition.classList.contains('hidden')) {
                element.classList.add('celebration');
                setTimeout(() => element.classList.remove('celebration'), 600);
            }
        }

        // Complete exercise
        function completeExercise(exerciseNum) {
            if (!exerciseStates[exerciseNum]) {
                exerciseStates[exerciseNum] = true;
                completedExercises++;
                addScore(10);
                updateProgress();
                
                const button = event.target;
                button.textContent = '‚úÖ Completado';
                button.classList.remove('bg-teal-500', 'hover:bg-teal-600', 'bg-orange-500', 'hover:bg-orange-600');
                button.classList.add('bg-gray-400');
                button.disabled = true;
            }
        }

        // Drag and drop functionality
        let draggedElement = null;

        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop();
        });

        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable');
            const dropZones = document.querySelectorAll('.drop-zone');

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.style.opacity = '0.5';
                });

                draggable.addEventListener('dragend', function(e) {
                    this.style.opacity = '1';
                });
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });

                zone.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });

                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    
                    if (draggedElement) {
                        this.appendChild(draggedElement);
                        draggedElement = null;
                    }
                });
            });
        }

        function checkGenders() {
            const masculineZone = document.getElementById('masculine-zone');
            const feminineZone = document.getElementById('feminine-zone');
            
            let correct = 0;
            let total = 0;

            // Check masculine zone
            const masculineItems = masculineZone.querySelectorAll('.draggable');
            masculineItems.forEach(item => {
                total++;
                if (item.dataset.gender === 'masculine') {
                    item.classList.add('correct');
                    correct++;
                } else {
                    item.classList.add('incorrect');
                }
            });

            // Check feminine zone
            const feminineItems = feminineZone.querySelectorAll('.draggable');
            feminineItems.forEach(item => {
                total++;
                if (item.dataset.gender === 'feminine') {
                    item.classList.add('correct');
                    correct++;
                } else {
                    item.classList.add('incorrect');
                }
            });

            const feedback = document.getElementById('gender-feedback');
            feedback.style.display = 'block';
            
            if (correct === 6 && total === 6) {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700';
                feedback.innerHTML = 'üéâ ¬°Perfecto! Has clasificado todos los g√©neros correctamente.';
                addScore(25);
                if (!exerciseStates[2]) {
                    exerciseStates[2] = true;
                    completedExercises++;
                    updateProgress();
                }
            } else {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700';
                feedback.innerHTML = `Tienes ${correct} de ${total} correctas. Recuerda: masculino (un/el), femenino (una/la).`;
            }
        }

        function resetGenders() {
            const originalContainer = document.getElementById('gender-words');
            const draggables = document.querySelectorAll('#masculine-zone .draggable, #feminine-zone .draggable');
            
            draggables.forEach(item => {
                item.classList.remove('correct', 'incorrect');
                originalContainer.appendChild(item);
            });
            
            document.getElementById('gender-feedback').style.display = 'none';
        }

        function checkMenu() {
            const answers = {
                'cafe-article': 'un',
                'tostada-article': 'una',
                'te-article': 'un',
                'cerveza-article': 'una',
                'agua-article': 'un',
                'agua-sin-article': 'un'
            };

            let correct = 0;
            let total = Object.keys(answers).length;

            for (let id in answers) {
                const select = document.getElementById(id);
                if (select.value === answers[id]) {
                    correct++;
                    select.classList.add('correct');
                } else {
                    select.classList.add('incorrect');
                }
            }

            const feedback = document.getElementById('menu-feedback');
            feedback.style.display = 'block';
            
            if (correct === total) {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700';
                feedback.innerHTML = 'üéâ ¬°Excelente! Has completado el men√∫ correctamente.';
                addScore(20);
                if (!exerciseStates[3]) {
                    exerciseStates[3] = true;
                    completedExercises++;
                    updateProgress();
                }
            } else {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700';
                feedback.innerHTML = `Tienes ${correct} de ${total} correctas. Nota: "agua" es femenino pero usa "un" por razones fon√©ticas.`;
            }
        }

        function checkCafeDialogue() {
            const dropZones = document.querySelectorAll('#cafe-dialogue-order .drop-zone');
            let correct = 0;
            let total = 0;

            dropZones.forEach((zone, index) => {
                const droppedItem = zone.querySelector('.draggable');
                if (droppedItem) {
                    total++;
                    const expectedOrder = parseInt(droppedItem.dataset.order);
                    const actualPosition = index + 1;
                    
                    if (expectedOrder === actualPosition) {
                        zone.classList.add('correct');
                        droppedItem.classList.add('correct');
                        correct++;
                    } else {
                        zone.classList.add('incorrect');
                        droppedItem.classList.add('incorrect');
                    }
                }
            });

            const feedback = document.getElementById('cafe-dialogue-feedback');
            feedback.style.display = 'block';
            
            if (correct === 5 && total === 5) {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700';
                feedback.innerHTML = 'üéâ ¬°Perfecto! Has ordenado la conversaci√≥n del caf√© correctamente.';
                addScore(25);
                if (!exerciseStates[4]) {
                    exerciseStates[4] = true;
                    completedExercises++;
                    updateProgress();
                }
            } else {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700';
                feedback.innerHTML = `Tienes ${correct} de ${total} en orden correcto. Escucha la conversaci√≥n del episodio.`;
            }
        }

        function resetCafeDialogue() {
            const originalContainer = document.getElementById('cafe-dialogue-options');
            const draggables = document.querySelectorAll('#cafe-dialogue-order .draggable');
            const dropZones = document.querySelectorAll('#cafe-dialogue-order .drop-zone');
            
            draggables.forEach(item => {
                item.classList.remove('correct', 'incorrect');
                originalContainer.appendChild(item);
            });
            
            dropZones.forEach(zone => {
                zone.classList.remove('correct', 'incorrect', 'drag-over');
            });
            
            document.getElementById('cafe-dialogue-feedback').style.display = 'none';
        }

        function checkMercheOrder() {
            const drink = document.querySelector('input[name="merche-drink"]:checked');
            const food = document.querySelector('input[name="merche-food"]:checked');
            
            const feedback = document.getElementById('merche-feedback');
            feedback.style.display = 'block';
            
            let correct = 0;
            if (drink && drink.value === 'cafe-leche') correct++;
            if (food && food.value === 'tostada') correct++;
            
            if (correct === 2) {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700';
                feedback.innerHTML = 'üéâ ¬°Correcto! Merche pide un caf√© con leche y una tostada.';
                addScore(15);
                if (!exerciseStates[5]) {
                    exerciseStates[5] = true;
                    completedExercises++;
                    updateProgress();
                }
            } else {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700';
                feedback.innerHTML = 'Escucha atentamente lo que dice Merche en el episodio.';
            }
        }

        function checkPhrases() {
            const answers = {
                'phrase1': 'quiere',
                'phrase2': 'm√°s',
                'phrase3': 'cuenta',
                'phrase4': 'urgente'
            };

            let correct = 0;
            let total = Object.keys(answers).length;

            for (let id in answers) {
                const select = document.getElementById(id);
                if (select.value === answers[id]) {
                    correct++;
                }
            }

            const feedback = document.getElementById('phrases-feedback');
            feedback.style.display = 'block';
            
            if (correct === total) {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700';
                feedback.innerHTML = 'üéâ ¬°Perfecto! Conoces las frases esenciales del caf√©.';
                addScore(20);
                if (!exerciseStates[6]) {
                    exerciseStates[6] = true;
                    completedExercises++;
                    updateProgress();
                }
            } else {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700';
                feedback.innerHTML = `Tienes ${correct} de ${total} correctas. Repasa las frases del episodio.`;
            }
        }

        function checkMetro() {
            const station = document.getElementById('metro-station').value.toLowerCase();
            const line = document.getElementById('metro-line').value;
            const reason = document.querySelector('input[name="metro-reason"]:checked');
            
            const feedback = document.getElementById('metro-feedback');
            feedback.style.display = 'block';
            
            let correct = 0;
            if (station.includes('latina')) correct++;
            if (line === '5') correct++;
            if (reason && reason.value === 'volver-casa') correct++;
            
            if (correct === 3) {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700';
                feedback.innerHTML = 'üéâ ¬°Perfecto! La Latina, l√≠nea 5, para volver a casa.';
                addScore(20);
                if (!exerciseStates[7]) {
                    exerciseStates[7] = true;
                    completedExercises++;
                    updateProgress();
                }
            } else {
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700';
                feedback.innerHTML = `Tienes ${correct} de 3 correctas. Escucha lo que dice Merche sobre el metro.`;
            }
        }

        function addScore(points) {
            totalScore += points;
            streak++;
            document.getElementById('totalScore').textContent = totalScore;
            document.getElementById('streak').textContent = streak;
            
            // Celebration animation
            const scoreElement = document.getElementById('totalScore');
            scoreElement.classList.add('celebration');
            setTimeout(() => scoreElement.classList.remove('celebration'), 600);
        }

        function updateProgress() {
            const progress = (completedExercises / totalExercisesCount) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '% completado';
            document.getElementById('completedExercises').textContent = completedExercises;
            
            if (completedExercises === totalExercisesCount) {
                showFinalSummary();
            }
        }

        function showFinalSummary() {
            const summary = document.getElementById('final-summary');
            summary.classList.remove('hidden');
            document.getElementById('finalScore').textContent = totalScore;
            summary.scrollIntoView({ behavior: 'smooth' });
        }

        // Send results to teacher
        async function sendToTeacher() {
            const studentName = document.getElementById('student-name').value.trim();
            const studentClass = document.getElementById('student-class').value.trim();
            const studentComments = document.getElementById('student-comments').value.trim();
            
            const feedback = document.getElementById('submission-feedback');
            
            if (!studentName || !studentClass) {
                feedback.style.display = 'block';
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-red-100 border border-red-300 text-red-700';
                feedback.innerHTML = '‚ùå Por favor completa todos los campos obligatorios (nombre y clase).';
                return;
            }
            
            const submissionData = {
                timestamp: new Date().toISOString(),
                studentName: studentName,
                studentClass: studentClass,
                episode: 'Episodio 2: En la Terraza',
                totalScore: totalScore,
                completedExercises: completedExercises,
                totalExercises: 8,
                completionPercentage: Math.round((completedExercises / 8) * 100),
                exerciseDetails: getExerciseDetails(),
                studentComments: studentComments || 'Sin comentarios'
            };
            
            try {
                feedback.style.display = 'block';
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-blue-100 border border-blue-300 text-blue-700';
                feedback.innerHTML = 'üì§ Enviando resultados al profesor...';
                
                setTimeout(() => {
                    feedback.className = 'feedback mt-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700';
                    feedback.innerHTML = '‚úÖ ¬°Resultados enviados exitosamente al profesor!';
                }, 2000);
                
            } catch (error) {
                console.error('Error sending to teacher:', error);
                feedback.className = 'feedback mt-4 p-3 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700';
                feedback.innerHTML = '‚ö†Ô∏è Hubo un problema al enviar. Por favor, descarga tus resultados y env√≠alos manualmente al profesor.';
            }
        }
        
        function getExerciseDetails() {
            const details = [];
            for (let i = 1; i <= 8; i++) {
                details.push({
                    exercise: i,
                    completed: exerciseStates[i] || false,
                    name: getExerciseName(i)
                });
            }
            return details;
        }
        
        function getExerciseName(exerciseNum) {
            const names = {
                1: 'Lugares de Madrid',
                2: 'G√©nero de Sustantivos',
                3: 'Men√∫ del Caf√©',
                4: 'Conversaci√≥n con el Camarero',
                5: 'Comprensi√≥n Auditiva',
                6: 'Frases del Caf√©',
                7: 'El Metro',
                8: 'Reflexi√≥n Cultural'
            };
            return names[exerciseNum] || `Ejercicio ${exerciseNum}`;
        }
        
        function downloadResults() {
            const studentName = document.getElementById('student-name').value.trim() || 'Estudiante';
            const studentClass = document.getElementById('student-class').value.trim() || 'No especificado';
            const studentComments = document.getElementById('student-comments').value.trim() || 'Sin comentarios';
            
            const results = `
MI VIDA LOCA - EPISODIO 2: EN LA TERRAZA
RESULTADOS DEL ESTUDIANTE
=====================================

INFORMACI√ìN DEL ESTUDIANTE:
- Nombre: ${studentName}
- Clase/Grupo: ${studentClass}

RESULTADOS:
- Puntuaci√≥n total: ${totalScore} puntos
- Ejercicios completados: ${completedExercises} de 8
- Porcentaje de finalizaci√≥n: ${Math.round((completedExercises / 8) * 100)}%

DETALLE DE EJERCICIOS:
${getExerciseDetails().map(ex => 
    `- ${ex.name}: ${ex.completed ? '‚úÖ Completado' : '‚ùå No completado'}`
).join('\n')}

COMENTARIOS DEL ESTUDIANTE:
${studentComments}

FECHA Y HORA DE GENERACI√ìN:
${new Date().toLocaleString('es-ES')}
            `.trim();
            
            const blob = new Blob([results], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Mi_Vida_Loca_Ep2_${studentName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            const feedback = document.getElementById('submission-feedback');
            feedback.style.display = 'block';
            feedback.className = 'feedback mt-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700';
            feedback.innerHTML = 'üíæ ¬°Archivo descargado! Puedes enviarlo por email a tu profesor.';
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'986fa1093649d03c',t:'MTc1OTE5MjQwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
