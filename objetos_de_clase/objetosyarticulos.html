<!DOCTYPE html>
<html lang="es" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>LecciÃ³n Interactiva: MisiÃ³n "El SalÃ³n de Clases"</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .feedback { display: none; }
        .instructions { font-style: italic; color: #4b5563; }
        .mission-card {
            transition: all 0.3s ease-in-out;
            border-left-width: 4px;
            border-left-color: #E5E7EB; /* gray-200 */
        }
        .mission-complete {
            border-left-color: #22C55E; /* green-500 */
            background-color: #F0FDF4; /* green-50 */
        }
        .progress-bar-fill { transition: width 0.5s ease-in-out; }
        .droppable-area {
            border: 2px dashed #9CA3AF;
            background-color: #F9FAFB;
            transition: all 0.2s;
        }
        .droppable-area.drag-over {
            background-color: #D1FAE5; /* green-100 */
            border-color: #10B981; /* green-500 */
            transform: scale(1.02);
        }
        .draggable { cursor: grab; transition: all 0.2s; }
        .draggable:active { cursor: grabbing; transform: scale(1.1); z-index: 10;}
        .draggable.selected {
            outline: 3px solid #8B5CF6; /* purple-500 */
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .correct-drop { border-style: solid; border-color: #22C55E; background-color: #F0FDF4; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 sm:p-6 md:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl">
        
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-bold text-purple-700 mb-2">MisiÃ³n: El SalÃ³n de Clases</h1>
            <p class="text-lg text-gray-500">Completa los 4 retos para dominar los objetos de la clase.</p>
            <div class="w-full bg-gray-200 rounded-full h-4 mt-6">
                <div id="progressBar" class="bg-purple-500 h-4 rounded-full progress-bar-fill" style="width: 0%"></div>
            </div>
        </header>

        <!-- Reto 1: Vocabulario -->
        <section id="mission1" class="mission-card bg-gray-50 p-6 rounded-lg border mb-8">
            <h3 class="text-2xl font-bold text-purple-600 mb-4 flex items-center"><span class="text-3xl mr-3">ðŸŽ’</span> Reto 1: Identifica tu Equipo / <span class="instructions ml-2">Identify Your Gear</span></h3>
            <p class="text-sm text-gray-600 mb-4">Arrastra o toca cada palabra en espaÃ±ol y luego su significado en inglÃ©s. / <span class="instructions">Drag or tap each Spanish word then its English meaning.</span></p>
            
            <div class="flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-2/3 space-y-3" id="meaning-list">
                    <!-- Meaning list will be generated by JS -->
                </div>
                <div class="w-full md:w-1/3 p-4 bg-white rounded-lg shadow-inner" id="word-bank">
                    <h4 class="font-bold mb-2 text-center">Palabras / <span class="instructions">Words</span></h4>
                    <!-- Words will be draggable -->
                </div>
            </div>

            <div class="text-center mt-6">
                <button onclick="checkMatching()" class="bg-purple-600 text-white px-5 py-2 rounded-md hover:bg-purple-700 transition">Verificar Equipo / <span class="instructions">Check Gear</span></button>
                <p class="feedback font-bold mt-2 flex items-center justify-center" id="feedback-mission1"></p>
            </div>
        </section>

        <!-- Reto 2: GÃ©nero y ArtÃ­culo -->
        <section id="mission2" class="mission-card bg-gray-50 p-6 rounded-lg border mb-8">
            <h3 class="text-2xl font-bold text-purple-600 mb-4 flex items-center"><span class="text-3xl mr-3">ðŸŽ¨</span> Reto 2: CÃ³digo Secreto / <span class="instructions">Secret Code</span></h3>
            <p class="text-sm text-gray-600 mb-4">Clasifica los objetos. Â¿Son masculinos o femeninos? / <span class="instructions">Sort the objects. Are they masculine or feminine?</span></p>
            
            <div class="flex flex-col sm:flex-row gap-4">
                <div class="w-full p-4">
                    <h4 class="text-lg font-bold text-center mb-2">Objetos a Clasificar / <span class="instructions">Objects to Sort</span></h4>
                    <div id="sort-bank" class="flex flex-wrap gap-2 justify-center p-4 bg-white rounded-lg shadow-inner min-h-[60px]"></div>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 mt-4">
                 <div class="w-full p-4 bg-blue-50 rounded-lg">
                    <h4 class="text-lg font-bold text-center text-blue-800 mb-2">Masculino (el, un)</h4>
                    <div id="masculino-drop" class="droppable-area min-h-[100px] p-2 flex flex-wrap gap-2 justify-center" data-gender="masculino"></div>
                </div>
                <div class="w-full p-4 bg-pink-50 rounded-lg">
                    <h4 class="text-lg font-bold text-center text-pink-800 mb-2">Femenino (la, una)</h4>
                    <div id="femenino-drop" class="droppable-area min-h-[100px] p-2 flex flex-wrap gap-2 justify-center" data-gender="femenino"></div>
                </div>
            </div>
            
            <div class="text-center mt-6">
                <button onclick="checkGenderSort()" class="bg-purple-600 text-white px-5 py-2 rounded-md hover:bg-purple-700 transition">Descifrar CÃ³digo / <span class="instructions">Crack Code</span></button>
                <p class="feedback font-bold mt-2 flex items-center justify-center" id="feedback-mission2"></p>
            </div>
        </section>

        <!-- Reto 3: Singular y Plural -->
        <section id="mission3" class="mission-card bg-gray-50 p-6 rounded-lg border mb-8">
            <h3 class="text-2xl font-bold text-purple-600 mb-4 flex items-center"><span class="text-3xl mr-3">âœ¨</span> Reto 3: Â¡Multiplicar! / <span class="instructions">Multiply!</span></h3>
            <p class="text-sm text-gray-600 mb-4">Escribe la forma plural de cada objeto. / <span class="instructions">Write the plural form of each object.</span></p>
            <div class="p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 mb-4">
                <strong>Pista / Hint:</strong> Si la palabra termina en vocal, aÃ±ade <strong>-s</strong>. Si termina en consonante, aÃ±ade <strong>-es</strong>. (Â¡Cuidado con 'lÃ¡piz'!)
            </div>
            <div class="space-y-3" id="plural-tasks">
                <!-- Plural tasks will be generated by JS -->
            </div>
             <div class="text-center mt-6">
                <button onclick="checkPlurals()" class="bg-purple-600 text-white px-5 py-2 rounded-md hover:bg-purple-700 transition">Verificar Plurales / <span class="instructions">Check Plurals</span></button>
                <p class="feedback font-bold mt-2 flex items-center justify-center" id="feedback-mission3"></p>
            </div>
        </section>
        
        <!-- Reto 4: AplicaciÃ³n -->
        <section id="mission4" class="mission-card bg-gray-50 p-6 rounded-lg border">
            <h3 class="text-2xl font-bold text-purple-600 mb-4 flex items-center"><span class="text-3xl mr-3">âœ…</span> Reto 4: Prepara la Mochila / <span class="instructions">Pack Your Backpack</span></h3>
            <p class="text-sm text-gray-600 mb-4">Arrastra o toca los objetos correctos de la estanterÃ­a y luego tu mochila. / <span class="instructions">Drag or tap the correct items from the shelf then your backpack.</span></p>

            <div id="supply-shelf" class="flex flex-wrap gap-2 justify-center p-4 bg-white rounded-lg shadow-inner my-4">
                <!-- Draggable items for mission 4 will be generated here -->
            </div>

            <div class="flex flex-col md:flex-row gap-6 items-start">
                <div class="w-full md:w-1/3 p-4 bg-white rounded-lg shadow">
                    <h4 class="font-bold mb-2">Lista / <span class="instructions">List</span></h4>
                    <ul class="list-disc list-inside">
                        <li>dos libros</li>
                        <li>un lÃ¡piz</li>
                        <li>una goma</li>
                    </ul>
                </div>
                <div class="w-full md:w-2/3 p-4 droppable-area rounded-lg" id="backpack-drop">
                     <h4 class="text-lg font-bold text-center text-gray-500 mb-2">Mi Mochila / <span class="instructions">My Backpack</span></h4>
                     <div id="backpack-items" class="flex-grow flex flex-wrap gap-2 min-h-[50px]"></div>
                </div>
            </div>
             <div class="text-center mt-6">
                <button onclick="checkBackpack()" class="bg-purple-600 text-white px-5 py-2 rounded-md hover:bg-purple-700 transition">Â¡Mochila Lista! / <span class="instructions">Backpack Ready!</span></button>
                <p class="feedback font-bold mt-2 flex items-center justify-center" id="feedback-mission4"></p>
            </div>
        </section>
        
        <div id="finalMessage" class="hidden mt-10 text-center p-6 bg-green-100 border-2 border-green-500 rounded-lg">
            <h2 class="text-3xl font-bold text-green-700">Â¡MisiÃ³n Cumplida!</h2>
            <p class="text-lg mt-2">Â¡Felicidades! Has organizado tu salÃ³n de clases y dominado el vocabulario. Â¡Excelente trabajo!</p>
        </div>
    </div>

    <script>
        const missionStatus = { 1: false, 2: false, 3: false, 4: false };
        let selectedItemId = null;
        const successIcon = `<svg class="h-6 w-6 text-green-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
        const errorIcon = `<svg class="h-6 w-6 text-red-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;

        const classroomObjects = [
            { id: 'libro', name: 'el libro', gender: 'masculino', plural: 'los libros', english: 'book' },
            { id: 'lapiz', name: 'el lÃ¡piz', gender: 'masculino', plural: 'los lÃ¡pices', english: 'pencil' },
            { id: 'cuaderno', name: 'el cuaderno', gender: 'masculino', plural: 'los cuadernos', english: 'notebook' },
            { id: 'goma', name: 'la goma', gender: 'femenino', plural: 'las gomas', english: 'eraser' },
            { id: 'mochila', name: 'la mochila', gender: 'femenino', plural: 'las mochilas', english: 'backpack' },
            { id: 'silla', name: 'la silla', gender: 'femenino', plural: 'las sillas', english: 'chair' }
        ];

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function initializeMissions() {
            const meaningList = document.getElementById('meaning-list');
            const wordBank = document.getElementById('word-bank');
            const sortBank = document.getElementById('sort-bank');
            const pluralTasks = document.getElementById('plural-tasks');
            const supplyShelf = document.getElementById('supply-shelf');

            let shuffledObjects = shuffle([...classroomObjects]);

            shuffledObjects.forEach(obj => {
                meaningList.innerHTML += `<div class="flex items-center space-x-2 bg-gray-100 p-2 rounded-lg"><span class="flex-grow capitalize text-lg">${obj.english}</span><div id="drop-${obj.id}" class="droppable-area h-12 w-32" data-answer="${obj.id}"></div></div>`;
                wordBank.innerHTML += `<div id="drag-${obj.id}" class="draggable bg-gray-200 p-2 rounded text-center text-lg" draggable="true" data-word="${obj.id}">${obj.name.split(' ')[1]}</div>`;
                sortBank.innerHTML += `<div id="sort-${obj.id}" class="draggable bg-gray-200 p-2 rounded" draggable="true" data-gender="${obj.gender}">${obj.name}</div>`;
                pluralTasks.innerHTML += `<div class="flex items-center space-x-2"><span>${obj.name}</span><span>â†’</span><input id="plural-${obj.id}" data-answer="${obj.plural}" type="text" placeholder="plural..." class="p-1 border border-gray-300 rounded-md w-40"></div>`;
            });
            
            supplyShelf.innerHTML += `<div id="supply-libro1" class="draggable bg-gray-200 p-2 rounded" draggable="true" data-item="libro">el libro</div>`;
            supplyShelf.innerHTML += `<div id="supply-libro2" class="draggable bg-gray-200 p-2 rounded" draggable="true" data-item="libro">el libro</div>`;
            supplyShelf.innerHTML += `<div id="supply-lapiz1" class="draggable bg-gray-200 p-2 rounded" draggable="true" data-item="lapiz">el lÃ¡piz</div>`;
            supplyShelf.innerHTML += `<div id="supply-goma1" class="draggable bg-gray-200 p-2 rounded" draggable="true" data-item="goma">la goma</div>`;
            supplyShelf.innerHTML += `<div id="supply-silla1" class="draggable bg-gray-200 p-2 rounded" draggable="true" data-item="silla">la silla</div>`;
            supplyShelf.innerHTML += `<div id="supply-cuaderno1" class="draggable bg-gray-200 p-2 rounded" draggable="true" data-item="cuaderno">el cuaderno</div>`;

            initializeInteractions();
        }

        function updateProgressBar() {
            const completedMissions = Object.values(missionStatus).filter(Boolean).length;
            const progress = (completedMissions / 4) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            if (completedMissions === 4) {
                document.getElementById('finalMessage').classList.remove('hidden');
            }
        }

        function completeMission(missionNumber, isCorrect = true) {
            if (!isCorrect || missionStatus[missionNumber]) return;
            missionStatus[missionNumber] = true;
            document.getElementById(`mission${missionNumber}`).classList.add('mission-complete');
            updateProgressBar();
        }
        
        function initializeInteractions() {
            const draggables = document.querySelectorAll('.draggable');
            const droppables = document.querySelectorAll('.droppable-area');

            // Traditional Drag and Drop for mouse users
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', e => {
                    e.target.classList.add('opacity-50');
                    e.dataTransfer.setData('text/plain', e.target.id);
                });
                draggable.addEventListener('dragend', e => e.target.classList.remove('opacity-50'));
            });

            droppables.forEach(droppable => {
                droppable.addEventListener('dragover', e => { e.preventDefault(); e.target.closest('.droppable-area').classList.add('drag-over'); });
                droppable.addEventListener('dragleave', e => e.target.closest('.droppable-area').classList.remove('drag-over'));
                droppable.addEventListener('drop', e => {
                    e.preventDefault();
                    const dropTarget = e.target.closest('.droppable-area');
                    dropTarget.classList.remove('drag-over');
                    const draggableId = e.dataTransfer.getData('text/plain');
                    handleDrop(draggableId, dropTarget);
                });
            });

            // Tap-to-move functionality for touch/mouse users
            draggables.forEach(draggable => {
                draggable.addEventListener('click', () => {
                    if (selectedItemId === draggable.id) {
                        draggable.classList.remove('selected');
                        selectedItemId = null;
                    } else {
                        if (selectedItemId) document.getElementById(selectedItemId)?.classList.remove('selected');
                        selectedItemId = draggable.id;
                        draggable.classList.add('selected');
                    }
                });
            });

            droppables.forEach(droppable => {
                droppable.addEventListener('click', () => {
                    if (selectedItemId) {
                         handleDrop(selectedItemId, droppable);
                    }
                });
            });
        }

        function handleDrop(draggableId, dropTarget) {
            const draggableElement = document.getElementById(draggableId);
            if (!draggableElement) return;

            // Mission 1: Only one item per slot
            if (dropTarget.id.startsWith('drop-') && dropTarget.children.length > 0) {
                 return; 
            }
            
            // Mission 4: Drop inside the correct container
            if (dropTarget.id === 'backpack-drop') {
                document.getElementById('backpack-items').appendChild(draggableElement);
            } else {
                dropTarget.appendChild(draggableElement);
            }

            // Clear selection after a successful drop
            if (selectedItemId) {
                draggableElement.classList.remove('selected');
                selectedItemId = null;
            }
        }
        
        function checkMatching() {
            let allCorrect = true;
            document.querySelectorAll('#meaning-list .droppable-area').forEach(dropArea => {
                const isCorrect = dropArea.children.length > 0 && dropArea.children[0].dataset.word === dropArea.dataset.answer;
                if(isCorrect) {
                    dropArea.classList.add('correct-drop');
                } else {
                    dropArea.classList.remove('correct-drop');
                    allCorrect = false;
                }
            });
            const feedback = document.getElementById('feedback-mission1');
            if(allCorrect) {
                feedback.innerHTML = `${successIcon} Â¡Equipo identificado!`;
                feedback.className = 'feedback font-bold text-green-600 flex items-center justify-center';
                completeMission(1);
            } else {
                feedback.innerHTML = `${errorIcon} Algo no estÃ¡ en su sitio. Revisa tu equipo.`;
                feedback.className = 'feedback font-bold text-red-600 flex items-center justify-center';
            }
            feedback.style.display = 'flex';
        }

        function checkGenderSort() {
            let allCorrect = true;
            document.querySelectorAll('#masculino-drop, #femenino-drop').forEach(dropArea => {
                const gender = dropArea.dataset.gender;
                const expectedCount = classroomObjects.filter(obj => obj.gender === gender).length;
                if (dropArea.children.length !== expectedCount) allCorrect = false;

                Array.from(dropArea.children).forEach(item => {
                    if(item.dataset.gender !== gender) allCorrect = false;
                });
            });

            const feedback = document.getElementById('feedback-mission2');
            if(document.getElementById('sort-bank').children.length > 0) allCorrect = false;

            if(allCorrect) {
                feedback.innerHTML = `${successIcon} Â¡CÃ³digo descifrado!`;
                feedback.className = 'feedback font-bold text-green-600 flex items-center justify-center';
                completeMission(2);
            } else {
                feedback.innerHTML = `${errorIcon} ClasificaciÃ³n incorrecta. IntÃ©ntalo de nuevo.`;
                feedback.className = 'feedback font-bold text-red-600 flex items-center justify-center';
            }
            feedback.style.display = 'flex';
        }
        
        function checkPlurals() {
            let allCorrect = true;
            document.querySelectorAll('#plural-tasks input').forEach(input => {
                const userAnswer = input.value.trim().toLowerCase();
                if(userAnswer === input.dataset.answer) {
                    input.classList.remove('border-red-500');
                    input.classList.add('border-green-500');
                } else {
                    input.classList.add('border-red-500');
                    input.classList.remove('border-green-500');
                    allCorrect = false;
                }
            });
            const feedback = document.getElementById('feedback-mission3');
             if(allCorrect) {
                feedback.innerHTML = `${successIcon} Â¡Objetos multiplicados!`;
                feedback.className = 'feedback font-bold text-green-600 flex items-center justify-center';
                completeMission(3);
            } else {
                feedback.innerHTML = `${errorIcon} Revisa las palabras en rojo.`;
                feedback.className = 'feedback font-bold text-red-600 flex items-center justify-center';
            }
            feedback.style.display = 'flex';
        }
        
        function checkBackpack() {
            const backpack = document.getElementById('backpack-items');
            const items = Array.from(backpack.children).map(child => child.dataset.item);

            const libroCount = items.filter(item => item === 'libro').length;
            const lapizCount = items.filter(item => item === 'lapiz').length;
            const gomaCount = items.filter(item => item === 'goma').length;
            const totalItems = items.length;

            const isCorrect = libroCount === 2 && lapizCount === 1 && gomaCount === 1 && totalItems === 4;

            const feedback = document.getElementById('feedback-mission4');
            if(isCorrect) {
                feedback.innerHTML = `${successIcon} Â¡Mochila perfecta!`;
                feedback.className = 'feedback font-bold text-green-600 flex items-center justify-center';
                completeMission(4);
            } else {
                feedback.innerHTML = `${errorIcon} Revisa la lista y el contenido de tu mochila.`;
                feedback.className = 'feedback font-bold text-red-600 flex items-center justify-center';
            }
            feedback.style.display = 'flex';
        }

        window.onload = initializeMissions;
    </script>
</body>
</html>

